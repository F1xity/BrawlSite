<html lang="fr">
<head>
    <a href="BrawlStars.html"><img src="Brawl Stars Logo.png" alt="BRAWLSTARS" width="100"></a>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script> <!-- Import Firestore -->
    <title>Connexion</title>
</head>
<body>
    <h2>Inscription</h2>

    <!-- Formulaire d'inscription -->
    <form id="register-form">
        <input type="text" id="pseudo" placeholder="Pseudo" required>
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Mot de passe" required>
        <button type="submit">S'inscrire</button>
    </form>

    <script>
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";
      // Configuration Firebase
      const firebaseConfig = {
    apiKey: "AIzaSyCgO1lL1_as8h_Ek-cdXY0N-Ds0syZPO4U",
    authDomain: "brawlstite.firebaseapp.com",
    projectId: "brawlstite",
    storageBucket: "brawlstite.firebasestorage.app",
    messagingSenderId: "701516244575",
    appId: "1:701516244575:web:14d6090c8ba08d3dfa1dea",
    measurementId: "G-MPL84N2S36"
  };
      firebase.initializeApp(firebaseConfig);
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = firebase.firestore();
      const auth = firebase.auth();

      // Gestion du formulaire d'inscription
      document.getElementById("register-form").addEventListener("submit", function(event) {
        event.preventDefault();
        const pseudo = document.getElementById("pseudo").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        auth.createUserWithEmailAndPassword(email, password)
          .then(userCredential => {
            const user = userCredential.user;
            // Enregistrer le pseudo dans Firestore
            db.collection('users').doc(user.uid).set({
              pseudo: pseudo
            }).then(() => {
              alert("Inscription réussie !");
              window.location.href = "index.html"; // Redirection vers l'accueil
            });
          })
          .catch(error => {
            alert(error.message);
          });
      });
    </script>
    <h2>Connexion</h2>

    <!-- Formulaire de connexion -->
    <form id="login-form">
        <input type="email" id="login-email" placeholder="Email" required>
        <input type="password" id="login-password" placeholder="Mot de passe" required>
        <button type="submit">Se connecter</button>
    </form>

    <script>
      // Gestion du formulaire de connexion
      document.getElementById("login-form").addEventListener("submit", function(event) {
        event.preventDefault();
        const email = document.getElementById("login-email").value;
        const password = document.getElementById("login-password").value;

        auth.signInWithEmailAndPassword(email, password)
          .then(userCredential => {
            const user = userCredential.user;
            // Récupérer le pseudo de Firestore
            db.collection('users').doc(user.uid).get()
              .then(doc => {
                if (doc.exists) {
                  const pseudo = doc.data().pseudo;
                  alert("Connexion réussie !");
                  // Enregistrer le pseudo dans sessionStorage
                  sessionStorage.setItem("pseudo", pseudo);
                  window.location.href = "index.html"; // Redirection vers l'accueil
                }
              });
          })
          .catch(error => {
            alert(error.message);
          });
      });
    </script>
</body>
</html>
